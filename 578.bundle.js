"use strict";(self.webpackChunkrspack_project=self.webpackChunkrspack_project||[]).push([["578"],{6137:function(e,t,a){a.r(t),a.d(t,{default:()=>S});var l,n=a(2800),r=a(2124),i=a(9663);a(1764);let s=(0,r.memo)(e=>{var t;let{item:a,onClick:l,active:c,icon:o}=e,[d,u]=(0,r.useState)(!1),{collapsed:h}=(0,i.j)(),f=a.children&&a.children.length>0;return(0,n.jsxs)("div",{className:"menu-group",children:[(0,n.jsx)("div",{className:"menu-item ".concat(c?"active":""),onClick:()=>{f?u(!d):a.path&&l(a)},children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("span",{className:"menu-item-icon",children:(0,n.jsx)("i",{className:h?o+" fa-lg fa-fw":o})}),(0,n.jsx)("span",{className:h?"menu-item-title":"menu-item-title active",children:a.title}),f&&(0,n.jsx)("span",{className:h?"menu-arrow":"menu-arrow active",children:(0,n.jsx)("i",{className:d?"fas fa-angle-down":"fas fa-angle-right"})})]})}),f&&d&&(0,n.jsx)("div",{className:"submenu",children:null==(t=a.children)?void 0:t.map(e=>(0,n.jsx)(s,{item:e,onClick:()=>l(e),active:c,icon:e.icon},e.id))})]})}),c=e=>{let{items:t,onSelect:a,activeKey:l}=e;return(0,n.jsx)("div",{className:"menu",children:null==t?void 0:t.map(e=>(0,n.jsx)(s,{item:e,onClick:a,active:e.id==l,icon:e.icon},e.id))})};var o=a(3630);function d(){let e=(0,o.P1)(),t=(0,o.FE)(),{pathname:a}=(0,o.zy)(),[l,n]=(0,r.useState)();return(0,r.useEffect)(()=>{var l,r;let i=t[t.length-1];(null==i?void 0:i.handle)&&n({title:null==i||null==(l=i.handle)?void 0:l.name,pathname:a,children:e,routePath:(null==i?void 0:i.pathname)||"",icon:null==i||null==(r=i.handle)?void 0:r.icon})},[a]),l}var u=a(4406),h=a(7184),f=a(3423);function m(){return new Date().getTime().toString()}a(4780);let p=e=>{let{tab:t,active:a,onClose:l,onDragStart:r,onDragOver:i,onDrop:s}=e;return(0,n.jsxs)("div",{className:"tab ".concat(a?"active":""),draggable:!0,onDragStart:r,onDragOver:i,onDrop:s,children:[(0,n.jsx)("span",{children:t.label}),(0,n.jsx)("span",{className:"close-icon",onClick:e=>{e.stopPropagation(),l(t.key,"remove")},children:"\xd7"})]})},v=e=>{let{tabs:t,activeTab:a,onTabsChange:l,onClose:i}=e,[s,c]=(0,r.useState)(null);return(0,o.Zp)(),(0,n.jsxs)("div",{className:"",children:[(0,n.jsx)("div",{className:"tablist flex flex-nowrap flex-row self-cente w-auto",children:t.map((e,l)=>(0,n.jsx)("div",{id:e.key,className:"w-auto h-full",onClick:()=>{},children:(0,n.jsx)(p,{tab:e,active:e.key===a,onClose:i,onDragStart:e=>{c({index:l,id:e.currentTarget.id}),e.dataTransfer.effectAllowed="move",e.dataTransfer.setDragImage(e.currentTarget,10,10)},onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},onDrop:e=>((e,a)=>{if(e.preventDefault(),s){let e=[...t],l=e[s.index];e.splice(s.index,1),e.splice(a,0,l),c(null)}})(e,l)})},e.key))}),(0,n.jsx)("div",{className:"tabs-body relative mt-5",children:t.map((e,t)=>(0,n.jsx)("div",{className:"tab-content  ".concat(e.key===a?"active":""),children:e.children&&e.children},e.key))})]})};var x=a(3937),g=a(2025);let j=(0,x.v)()((0,g.Zr)(e=>({user:null,setUser:t=>e({user:t}),logout:()=>{e({})}}),{name:"user-storage"}));var b=a(8199),w=a(1156),y=a(7745);let k=()=>{let{user:e,logout:t}=j(),{darkMode:a,setDarkMode:l}=(0,i.j)();return(0,n.jsxs)("div",{className:"flex flex-row h-full",children:[(0,n.jsx)("div",{className:"w-14 self-center",children:(0,n.jsx)(b.A,{onClick:e=>{!0==e?l(!0):l(!1),document.documentElement.classList.toggle("dark",a&&window.matchMedia("(prefers-color-scheme: dark)").matches)}})}),(0,n.jsxs)("div",{className:"w-18 self-center",children:[(0,n.jsx)(w.A,{menu:{items:[{key:"1",label:"My Account",disabled:!0},{type:"divider"},{key:"2",label:"退出",icon:"",extra:"",onClick:()=>{t()}}]},children:(0,n.jsxs)("a",{onClick:e=>e.preventDefault(),children:[(0,n.jsx)("label",{className:"text-center",children:null==e?void 0:e.name}),"  ",(0,n.jsx)(y.A,{src:""+(null==e?void 0:e.avatar)})]})})," "]})]})};var N=a(6187),P=((l={})[l.Catalog=1]="Catalog",l[l.Menu=2]="Menu",l[l.Button=3]="Button",l),O=a(5824);function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},l=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),l.forEach(function(t){var l;l=a[t],t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l})}return e}function D(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);a.push.apply(a,l)}return a})(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}),e}let S=()=>{let{loading:e}=function(){let[e,t]=(0,r.useState)(!0),{refreshToken:a,token:l}=(0,i.j)(),{setUser:n}=j(),{data:s,loading:c}=(0,O.A)(N.y.getCurrentUser,{refreshDeps:[a],onError:()=>{u.Q.navigate("/login")}});return(0,r.useEffect)(()=>{if(!s)return;t(!0);let{menus:e=[],permissions:a}=s,l=null==a?void 0:a.reduce((e,t)=>(t.parentId&&(e[t.parentId]||(e[t.parentId]=[]),e[t.parentId].push(t)),e),{}),r=[];n(D(C({},s),{flatMenus:r,menus:function e(t,a,l,n){return t.map(t=>{let r=a[t.id],i=(null==n?void 0:n.parentPaths)||[],s=i[i.length-1],c=(n?"".concat(s).concat(t.path):t.path)||"";return l.push(D(C({},t),{path:c,parentPaths:i})),D(C({},t),{path:c,parentPaths:i,children:(null==r?void 0:r.length)?e(r,a,l,D(C({},t),{parentPaths:[...i,c||""].filter(e=>e)})):void 0})})}(null==a?void 0:a.filter(e=>!e.parentId),l,r),authList:e.filter(e=>e.type===P.Button&&e.authCode).map(e=>e.authCode)})),u.Q.navigate("".concat(location.pathname).concat(location.search),{replace:!0}),t(!1)},[s,n]),{loading:c||e}}(),{activeTabRoutePath:t,tabs:a=[],closeTab:l,refreshTab:s,closeOtherTab:p,setTabs:x}=function(){let[e,t]=(0,h.A)("keepAliveTabs",{defaultValue:[],serializer:e=>JSON.stringify(e.map(e=>(0,f.omit)(e,["children"])))}),[a,l]=(0,r.useState)(""),n=d(),i=(0,r.useCallback)(function(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a||"";if(!(null==e?void 0:e.length))return;let n=(e||[]).findIndex(e=>e.routePath===l);e[n].routePath===a&&e.length>1&&(n>0?u.Q.navigate(e[n-1].routePath):u.Q.navigate(e[n+1].routePath)),e.splice(n,1),t([...e])},[a]),s=(0,r.useCallback)(function(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a||"";if(!(null==e?void 0:e.length))return;let n=e.find(e=>e.routePath===l);t(e.filter(e=>e.routePath===l)),u.Q.navigate((null==n?void 0:n.pathname)||l)},[a]),c=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a||"";t(t=>{let a=(t||[]).findIndex(t=>t.routePath===e);return a>=0&&t&&(t[a].key=m()),[...t||[]]})},[a]);return(0,r.useEffect)(()=>{if(!n)return;let a=(e||[]).find(e=>e.routePath===(null==n?void 0:n.routePath));a?a.pathname!==n.pathname?t(e=>{let t=(e||[]).findIndex(e=>e.routePath===n.routePath);return t>=0&&e&&(e[t].key=m(),e[t].pathname=n.pathname,e[t].children=n.children),[...e||[]]}):a.children||t(e=>{let t=(e||[]).findIndex(e=>e.routePath===n.routePath);return t>=0&&e&&(e[t].key=m(),e[t].children=n.children),[...e||[]]}):t([...e||[],{title:n.title,key:m(),routePath:n.routePath,pathname:n.pathname,children:n.children,icon:n.icon}]),l(n.routePath)},[n]),{tabs:e,activeTabRoutePath:a,closeTab:i,closeOtherTab:s,refreshTab:c,setTabs:t}}(),{collapsed:g,setCollapsed:b}=(0,i.j)(),[w,y]=(0,r.useState)(""),{user:S}=j(),E=null==S?void 0:S.permissions,I=(0,o.Zp)(),T=(0,o.zy)(),A=(0,r.useRef)(!1);d(),(0,r.useEffect)(()=>{A.current||(A.current=!0)},[T.pathname]);let z=(0,r.useMemo)(()=>a.map(e=>({key:e.routePath,label:e.title,children:(0,n.jsx)("div",{className:"overflow-y-auto",children:e.children},e.key),closable:a.length>1})),[a]),M=(0,r.useCallback)(e=>{u.Q.navigate(e)},[]);return(0,n.jsxs)("div",{className:"relative isolate flex min-h-svh w-full bg-white max-lg:flex-col lg:bg-zinc-100 dark:bg-zinc-900 dark:lg:bg-zinc-950",children:[(0,n.jsxs)("div",{className:g?"h-full w-20":"h-full w-64 lg:w-48 menu-slide bg-transparent transition-all top-header fixed box-border left-0 bottom-0 overflow-y-auto px-[16px] max-md:hidden dark:text-white bg-white",children:[(0,n.jsx)("div",{className:"h-10"}),(0,n.jsx)(c,{items:E,onSelect:e=>{e.children||(y(e.id),I(e.path))},activeKey:w})]}),(0,n.jsx)("main",{className:g?"flex flex-1 flex-col pb-2":"flex flex-1 flex-col pb-2 lg:min-w-0 lg:pt-2 lg:pr-2 lg:pl-64",children:(0,n.jsxs)("div",{className:"h-16 bg-white ml-4 mr-4 ",children:[(0,n.jsxs)("div",{className:"flex items-stretch h-full",children:[(0,n.jsx)("div",{className:"w-14 self-center",children:(0,n.jsx)("div",{className:"text-center",onClick:()=>b(!g),children:(0,n.jsx)("i",{className:g?"fas fa-indent fa-fw fa-lg":"fas fa-outdent fa-fw fa-lg"})})}),(0,n.jsx)("div",{className:"w-64 flex items-stretch"}),(0,n.jsx)("div",{className:"w-32",children:(0,n.jsx)(k,{})})]}),(0,n.jsx)("div",{className:"w-100 flex items-stretch mt-5",children:a?(0,n.jsx)(v,{tabs:z,activeTab:w,onTabsChange:M,onClose:(e,t)=>{"remove"===t&&l(e)}}):(0,n.jsx)(o.sv,{})})]})})]})}},4780:function(e,t,a){e.exports={}},1764:function(e,t,a){e.exports={}}}]);
//# sourceMappingURL=578.bundle.js.map